<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏îshboard - ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <a href="dashboard.html" class="navbar-brand">üîß ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
            <div class="navbar-menu">
                <a href="dashboard.html">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <a href="repair-requests.html">‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°</a>
                <a href="equipment.html">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
                <a href="profile.html">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
                <span id="userName" style="color: #64748b;"></span>
                <button id="logoutBtn" class="btn-logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <h1 class="mb-3">‡πÅ‡∏îshboard</h1>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                <div class="number" id="totalRequests">0</div>
            </div>
            <div class="stat-card warning">
                <h3>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
                <div class="number" id="pendingRequests">0</div>
            </div>
            <div class="stat-card info">
                <h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
                <div class="number" id="inProgressRequests">0</div>
            </div>
            <div class="stat-card success">
                <h3>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</h3>
                <div class="number" id="completedRequests">0</div>
            </div>
        </div>

        <!-- Equipment Stats -->
        <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr);">
            <div class="stat-card">
                <h3>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                <div class="number" id="totalEquipment">0</div>
            </div>
            <div class="stat-card success">
                <h3>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</h3>
                <div class="number" id="activeEquipment">0</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô</div>
            <div class="d-flex gap-2">
                <a href="create-request.html" class="btn btn-primary">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà</a>
                <a href="repair-requests.html" class="btn btn-secondary">üìã ‡∏î‡∏π‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
                <a href="equipment.html" class="btn btn-secondary">üîß ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
            </div>
        </div>

        <!-- Recent Requests -->
        <div class="card">
            <div class="card-header">‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
            <div id="loadingRecent" class="loading">
                <div class="spinner"></div>
                <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
            </div>
            <div id="recentRequestsContainer"></div>
        </div>
    </div>

    <script src="assets/js/api.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
        // Check authentication
        requireAuth();

        // Load dashboard data
        async function loadDashboard() {
            try {
                const loading = document.getElementById('loadingRecent');
                loading.classList.add('active');

                const stats = await dashboardAPI.getStats();

                // Update stats
                document.getElementById('totalRequests').textContent = stats.total_requests;
                document.getElementById('pendingRequests').textContent = stats.pending_requests;
                document.getElementById('inProgressRequests').textContent = stats.in_progress_requests;
                document.getElementById('completedRequests').textContent = stats.completed_requests;
                document.getElementById('totalEquipment').textContent = stats.total_equipment;
                document.getElementById('activeEquipment').textContent = stats.active_equipment;

                // Display recent requests
                displayRecentRequests(stats.recent_requests);

                loading.classList.remove('active');
            } catch (error) {
                console.error('Error loading dashboard:', error);
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
            }
        }

        function displayRecentRequests(requests) {
            const container = document.getElementById('recentRequestsContainer');

            if (requests.length === 0) {
                container.innerHTML = '<p class="text-center" style="padding: 2rem;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°</p>';
                return;
            }

            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</th>
                            <th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th>
                            <th>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</th>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${requests.map(request => `
                            <tr>
                                <td>${request.request_number}</td>
                                <td>${request.title}</td>
                                <td>${request.equipment_name}</td>
                                <td><span class="badge ${getStatusBadge(request.status)}">${request.status_display}</span></td>
                                <td><span class="badge ${getPriorityBadge(request.priority)}">${request.priority_display}</span></td>
                                <td>${formatDate(request.request_date)}</td>
                                <td>
                                    <a href="repair-requests.html?id=${request.id}" class="btn btn-sm btn-primary">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
        });
    </script>
</body>
</html>